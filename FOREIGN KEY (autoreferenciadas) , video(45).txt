hola que tal youtube videntes bienvenidos una vez más a este en su canal informático fit a este curso de oracle sql desde cero vamos a continuar explorando las llaves foráneas en el día de hoy vamos a ver cómo funcionan las llaves foráneas auto referenciadas en una misma tabla anteriormente ya estuvimos viendo las reglas para la configuración de llaves foráneas para relacionar datos entre dos o más tablas pues en el día de hoy vamos a ver cómo podemos definir esta restricción pero enlazando datos dentro de una misma tabla para empezar en nuestro editor vamos a eliminar la tabla de clientes que teníamos creada anteriormente cuando un sistema nos confirma que se elimina esta tabla vamos a proceder a crearla de nuevo con las configuraciones que necesitamos para esto vamos a iniciar diciendo create 'tablet' clientes abrimos paréntesis creamos el primer campo que se va a llamar código de tipo nombre tamaño cinco coma debajo el campo nombre de tipo parchar 230 caracteres de tamaño cerramos paréntesis colocamos una coma debajo creamos el campo domicilio que va a ser este tipo parchar dos y va a tener 30 caracteres de tamaño debajo un nuevo campo se llama ciudad qué tipo parchar dos igualmente 20 caracteres de tamaño por último el campo referenciado por que va a ser de tipo nombre tamaño 5 de caracteres vamos a establecer una clave primaria para nuestro campo código luego que establecemos nuestra llave primaria vamos a cerrar paréntesis y colocar punto y coma sobre amos y ejecutamos nos dice el sistema que se creó nuestra tabla de clientes luego que tengamos nuestra tabla de clientes ya creada nos vamos a ir a la descripción del vídeo vamos a copiar unos inserts que tenemos detallados ahí y lo vamos a pegar en nuestro editor de esta manera vamos a seleccionar y ejecutar todas las inserciones aquí están sin errores vamos entonces a borrar la creación de la tabla dejamos los inserts en el escritorio y vamos a hacer un select a la tabla y aquí están los registros que acabamos de insertar vamos a hacer lo siguiente entonces vamos a crear una restricción vamos a crear una llave foránea y la vamos a auto referencia al campo código la llave foránea será creada para este campo referenciado por y le vamos a auto enlazar dentro de la misma tabla al campo código como hacemos esto pues decimos alter table clientes debajo constraints colocamos el prefijo efe acá le vamos a dar un nombre referencia luego debajo vamos a decir que nuestra regla será un fortín y aplicado a nuestro campo referenciado por cerramos paréntesis y luego debajo decimos y vamos a enlazar esta llave foránea de nuestra tabla clientes al campo código que es la misma tabla donde estamos trabajando vamos a colocar un punto y coma y vamos a proceder a ejecutar la creación de la llave foránea cuando ejecutamos tenemos un mensaje de error y qué es lo que nos dice este mensaje no se puede validar la llave foránea que se acaba de crear y fíjense aquí como el registro no se especifica la causa de que una validación a la alteración de la tabla con un constraints falla porque la tabla tiene registros hijos y qué significa esto que estamos creando una regla en donde nos dice que estamos creando una llave foránea para un campo que tiene ya configurada una clave primaria dentro de la misma tabla si hacemos un select a la tabla si se fijan código es nuestro campo llave primaria la regla que estamos implementando es para nuestro campo referenciado por esto indica que como código es llave primaria los registros deben ser exactamente iguales si se fijan nosotros aquí tenemos un registro que no va con ninguno de los que ya tiene insertado el campo código que es este campo el número 9 porque ya tenemos un 90 acá ya tenemos un 50 acá y de igual modo hay dos registros nulos por lo tanto no se puede aplicar la restricción de llave foránea a este campo ya que no puede validarse porque hay registros que violan dicha regla entonces lo que vamos a hacer es corregir el registro que nos está creando el inconveniente vamos a decir tape clientes sed referenciado por igual a 90 donde el mismo campo el presenciado por es igual a 9 y qué estamos haciendo aquí estamos diciendo el sistema que actualice en la tabla clientes el valor 9 este campo y que lo establezca como 90 ya que este registro si puedes referenciar el valor 90 que ya existe en el campo código vamos a realizar el update y aquí el sistema nos dice que ya se actualizó este registro por lo tanto ahora vamos a intentar de nuevo establecer la regla de la llave foránea auto referenciada y el sistema nos dice que la tabla de clientes fue alterada lo que indica que acepto la llave foránea pasemos de nuevo un select a la tabla de clientes aquí está el registro que acabamos de actualizar vamos a intentar borrar el primer registro de la tabla vamos a decirle al sistema lit from clientes donde código sea igual a 50 seleccionamos cuando ejecutamos el sistema no nos permite borrar el registro y nos dice que se está violando la restricción for ink y que acabamos de crear al campo código de nuestra tabla de clientes si se fijan el registro que está tomando como referencia es un valor nulo por lo tanto esto nos confirma que la restricción aplica también para valores null es decir las reglas se aplican al campo no al registro vamos a intentar ahora borrar el registro número 3 de esta tabla de clientes en este caso vamos a decir que nos elimine el valor en donde el campo referenciados por sea 50 ejecutamos esta instrucción y vemos que el sistema sí nos permitió borrar el registro ahí esta registro número tres fue borrado esto es así porque se cumple la regla de que se toma como parámetro para eliminar la llave foránea en lugar de llave primaria es decir no podemos ejecutar un delete en una tabla tomando como filtro el campo llave primaria ya que el sistema analiza que tiene registros enlazados y en este caso están dentro de la misma tabla sin embargo si podemos eliminar los registros filtrando los campos que tienen restricción de llave foránea ya que éstos no dependen de ninguna restricción de enlace en este caso pudimos hacerlo con el valor 50 y bien eso es todo por ahora referente a las llaves foráneas auto referenciadas a una misma tabla más adelante continuaremos viendo más y más ejemplos de falling key gracias por su atención y hasta la próxima entrega