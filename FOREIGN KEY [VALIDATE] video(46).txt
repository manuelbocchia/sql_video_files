hola que tal youtube videntes bienvenidos a una nueva entrega de este curso de oracle sql desde cero continuamos explorando las reglas de llaves foráneas y anteriormente estuvimos viendo que si agregamos una restricción a una tabla que contiene datos pues ahora con los controles para asegurarse que cumplen con dicha restricción si los datos no cumplen con esta regla pues no se permite la creación de esta restricción sin embargo existe una modalidad para crear llaves foráneas en campos que contengan registros que no cumplan con los requerimientos en el día de hoy vamos a ver cómo es posible esta configuración de esta modalidad para los ejemplos del día de hoy pues vamos a ir a la descripción del vídeo y vamos a copiar las instrucciones que están allí y las vamos a pegar en nuestro editor de esta forma procedemos entonces a ejecutarlas y verificamos que todo se hizo correctamente con el borrado de dos tablas que teníamos ya creadas y la nueva creación con las configuraciones que necesitamos y la correcta inserción de los datos dentro de las mismas todo esto sin errores cuando confirmemos todo esto conoceremos a limpiar nuestro editor de código y limpiamos nuestra salida de consola hacemos una consulta a la tabla de clientes y están los registros con los que vamos a trabajar hoy y hacemos una consulta a nuestra tabla de provincias correcto de inmediato vamos a realizar la siguiente consulta a la tabla de reglas de usuario vamos a colocar la instrucción select constraints name colocamos una coma status como válida luego debajo decimos from y usher constraints más abajo web table name igual a clientes cerramos comillas punto y coma hacemos la consulta y nos dice que hay un error de missing expresión es porque colocamos valida y en lugar de colocar validated así seleccionamos y ejecutamos de nuevo y aquí vemos tenemos un constraints name nivel de administrador una llave primaria que está habilitada y validada eso lo hicimos cuando creamos la tabla de clientes pueden verlo en el código así que lo que vamos a hacer ahora es crear una llave foránea que enlace a nuestro campo código provincia desde la tabla de provincias esto lo vamos a hacer viendo que ya existen registros en el campo código provincia así que vamos a ejecutar la siguiente instrucción decimos alter table clientes debajo colocamos up constraints y colocamos el prefijo efe acá para indicar que es for in y le vamos a dar de nombre o digo provincia luego debajo decimos que va a ser una regla de tipo fortín que y que lo vamos a aplicar al campo código provincia cerramos paréntesis y debajo decimos referencias provincias y dentro de paréntesis código con esto decimos que vamos a referenciar nuestro for inc y a la tabla provincias en su campo código colocamos punto y coma seleccionamos toda esta instrucción la ejecutamos y aquí tenemos un error que vamos a analizar nos dice aquí que no se puede realizar la alteración de la tabla con esta regla porque se encontraron registros en la misma vamos entonces hacer un selecto a la tabla clientes que es lo que vemos aquí en el campo código provincia registros 1 2 3 4 y 5 si hacemos entonces un select a la tabla provincias estamos viendo que los registros válidos son del 1 al 4 en el campo código por lo tanto no hay ningún registro 5 que pueda compaginar con este registro de acá por lo tanto el sistema no puede ejecutar la acción de configurar la llave foránea porque hay un registro que no cumple con la regla como podemos entonces configurar la llave foránea a esta tabla teniendo un registro que no lo permita pues para esto entonces simple le vamos a colocar a la configuración de álter table que tenemos acá después de código la instrucción no valida con esto estamos invalidando el chequeo de la regla que indica que los registros entre un ford ink y un primer y que deben ser iguales le estamos diciendo ahora con que no valide esta regla y que cree la llave foránea a nuestra tabla de clientes seleccionamos y ejecutamos y fíjense ahora como el sistema dice que alteró correctamente la tabla es decir creó el fortín que vamos a colocar de nuevo el select a nuestra tabla de reglas de usuario en donde la tabla sea clientes y verificamos aquí el for inc y que acabamos de crear con el estatus habilitado es decir el fortín que está creado y habilitado pero la validación dice que fue creado con not válida y esto indica que el ford in king se creó sobre una tabla que tenía registros que no cumplían con la regla de primeriti y forlín que es lo que indica esta validación sin embargo el fork y ésta en neiva es decir ha habilitado si intentáramos insertar un registro que no cumpla con la regla el sistema no permitirá el inserto vamos a aprobar esto insertando un registro a nuestra tabla de clientes diciendo insert into clientes salud abrimos paréntesis vamos a colocarle 110 o más vamos a colocarle como nombre garcía omar cerramos comillas coma comillas de nuevo dirección san martín número 100 cerramos comillas coma abrimos comillas de nuevo vamos a colocarle ciudad cerramos comillas y luego en el código de provincia le vamos a colocar un 6 este es un valor que colocamos una coma este 6 es un valor que no cumple con los requisitos de llave foránea y llave primaria cerramos paréntesis colocamos punto y coma ejecutamos el insert y aquí está el bloqueo nos está diciendo que se está violando la regla for inc y código provincia que creamos en donde indica que los registros entre un ford y key primary key deben ser iguales este 6 es distinto a los demás registros que ya existen en la validación si se fijan debe ser un número entre 1 y 5 si colocamos un 6 estamos violentando la regla por lo tanto no se puede insertar el registro como podemos insertar un registro que viole la regla pues para esto simplemente ejecutamos la siguiente instrucción altar table clientes y colocamos disabled no válida y luego debajo decimos constraints vamos a colocar el nombre de nuestro foro y código provincia lo ponemos acá punto y coma seleccionamos ejecutamos nos dice el sistema que se alteró la tabla de clientes ahora si procedemos a insertar el registro que nos falló anteriormente el sistema lo inserta sin problemas vamos a hacer de nuevo un selecto a nuestra tabla de reglas de usuario y que vemos aquí que el estatus dice disabled porque lo que hicimos aquí fue alteramos en la tabla de clientes deshabilitando la no validación en la regla efe ks código provincia lo que hicimos fue deshabilitamos la regla de for inc y al deshabilitar la pues se permite ingresar registros que no cumplan con las reglas de llave primaria y llave foránea para volver a habilitar la regla y que no se permitan estos registros simplemente cambiamos el disabled por 1 en neiva bueno vemos acá seleccionamos ejecutamos el sistema nos dice que se alteró la tabla hacemos de nuevo una consulta en nuestra tabla de reglas de usuario y aquí está habilitado de nuevo nuestra llave foránea queda de nuevo habilitada en la tabla y por lo tanto no se va a permitir la inserción de registros que no cumplan con la regla en el campo código provincia si se están preguntando qué utilidad tiene configurar reglas en una tabla que tiene registros que violan la misma pues esto se utiliza para evitar tener que borrar la regla y crearla de nuevo esta opción de validez y no válida permite configurar llaves foráneas desde cualquier tabla que tenga campos que cumplan con los requerimientos de configuración para ser llave foránea de alguna u otra llave primaria es decir nos facilita el trabajo en la configuración de reglas en tablas que ya están creadas y bien eso es todo por ahora referente a la creación de llaves foráneas las tablas que ya contienen registros pueden continuar practicando y creando más situaciones y ejemplos para seguir viendo cómo trabaja esta regla nos veremos en una próxima entrega gracias por su atención y hasta pronto